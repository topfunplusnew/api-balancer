openapi: 3.0.3
info:
  title: Express Starter API
  description: |
    Express Starter API 文档
    
    本API提供以下功能：
    - 健康检查
    - 用户鉴权和API Key管理
    - 持久化APIKEY管理
    - 第三方API代理服务
    
    ## 鉴权方式
    
    本API支持两种鉴权方式：
    
    1. **Bearer Token（临时Token）**
       - 通过 `/api/v1/auth/api-key` 或 `/auth/api-key` 接口获取
       - 存储在内存中，服务重启后失效
       - 使用方式：`Authorization: Bearer {access_key}`
    
    2. **APIKEY（持久化Key）**
       - 通过 `/api/v1/api-keys` 或 `/api-keys` 接口创建
       - 存储在数据库中，服务重启后仍然有效
       - 支持过期时间设置和启用/禁用
       - 使用方式：
         - 请求头：`X-API-Key: {api_key}`
         - 查询参数：`?api_key={api_key}`
    
    鉴权优先级：优先使用Bearer Token，如果没有或无效，则使用APIKEY。
    
    **注意**：所有接口都支持两种路径格式：
    - 完整路径：`/api/v1/{path}` （推荐）
    - 便捷路径：`/{path}` （兼容旧版本）
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:5000/api/v1
    description: 本地开发环境
  - url: https://api.example.com/api/v1
    description: 生产环境

tags:
  - name: Info
    description: 系统信息相关接口
  - name: Template Config
    description: 模板配置相关接口
  - name: Auth
    description: 鉴权相关接口
  - name: ApiKeys
    description: APIKEY管理接口（需要鉴权）
  - name: Creatomate API
    description: Creatomate 视频渲染服务代理接口
  - name: Proxy
    description: 通用API代理服务

paths:
  /info:
    get:
      tags:
        - Info
      summary: 健康检查
      description: 检查API服务是否正常运行
      operationId: getInfo
      security: []
      responses:
        '200':
          description: 服务正常运行
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: API is live
                  error:
                    type: object
                    example: {}
                  data:
                    type: object
                    example: {}
              example:
                success: true
                message: API is live
                error: {}
                data: {}
  
  /template-config:
    get:
      tags:
        - Template Config
      summary: 获取模板配置
      description: 返回固定的模板配置结构，用于表单渲染
      security: []
      responses:
        '200':
          description: 获取模板配置成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "获取模板配置成功"
                  data:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "template_id"
                      type:
                        type: string
                        example: "select"
                      label:
                        type: string
                        example: "草稿ID"
                      options:
                        type: object
                        properties:
                          store:
                            type: string
                            example: "rpc://getTemplates"
                          nested:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                  example: "json"
                                type:
                                  type: string
                                  example: "text"
                                label:
                                  type: string
                                  example: "知识库文件ID"
                                required:
                                  type: boolean
                                  example: true
                                help:
                                  type: string
                                  example: "JSON"
                      required:
                        type: boolean
                        example: true
                      help:
                        type: string
                        example: "获取草稿信息"
                  error:
                    type: object
                    example: {}
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/api-key:
    post:
      tags:
        - Auth
      summary: 获取临时API Key（Bearer Token）
      description: |
        通过提供用户名和密码进行用户鉴权，验证成功后生成临时API Key（Bearer Token）。
        获取到的access_key将用于后续API请求的鉴权。
        
        **注意**：此接口生成的是临时Token，存储在内存中，服务重启后会失效。
        如需持久化的APIKEY，请使用 `/api-keys` 接口创建。
      operationId: getApiKey
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: 用户名
                  example: admin
                password:
                  type: string
                  description: 密码
                  format: password
                  example: your_password
            examples:
              basic:
                summary: 基本请求
                value:
                  username: admin
                  password: your_password
      responses:
        '200':
          description: API Key获取成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      access_key:
                        type: string
                        description: 访问密钥，用于后续API请求的Bearer token
                        example: admin_1234567890_abcdef1234567890
                      message:
                        type: string
                        example: API key已生成，请使用access_key作为Bearer token进行鉴权
              example:
                success: true
                data:
                  access_key: admin_1234567890_abcdef1234567890
                  message: API key已生成，请使用access_key作为Bearer token进行鉴权
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                default:
                  value:
                    success: false
                    message: "缺少必填字段: username 和 password"
                    error: {}
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                default:
                  value:
                    success: false
                    message: "用户名或密码错误"
                    error: {}
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                default:
                  value:
                    success: false
                    message: "获取API key失败"
                    error: {}
  
  /api-keys:
    post:
      tags:
        - ApiKeys
      summary: 创建持久化APIKEY
      description: |
        创建持久化的APIKEY，存储在数据库中，服务重启后仍然有效。
        需要先通过 `/api/v1/auth/api-key` 或 `/auth/api-key` 接口获取临时Token，然后使用Bearer Token进行鉴权。
        
        **重要**：APIKEY创建后只会在响应中显示一次，请妥善保管。
        
        **路径说明**：
        - 完整路径：`POST /api/v1/api-keys`
        - 便捷路径：`POST /api-keys`
      operationId: createApiKey
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: APIKEY名称（可选）
                  example: My Production API Key
                expires_at:
                  type: string
                  format: date-time
                  description: 过期时间（可选，ISO 8601格式）
                  example: "2026-12-31T23:59:59Z"
            examples:
              basic:
                summary: 基本请求（使用默认名称）
                value: {}
              withName:
                summary: 指定名称
                value:
                  name: Production API Key
              withExpiry:
                summary: 指定过期时间
                value:
                  name: Temporary API Key
                  expires_at: "2026-12-31T23:59:59Z"
      responses:
        '201':
          description: APIKEY创建成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: APIKEY ID
                      api_key:
                        type: string
                        description: 生成的APIKEY（只显示一次）
                        example: sk_1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
                      name:
                        type: string
                        description: APIKEY名称
                      created_at:
                        type: string
                        format: date-time
                        description: 创建时间
                      expires_at:
                        type: string
                        format: date-time
                        nullable: true
                        description: 过期时间
                      message:
                        type: string
                        example: APIKEY 已生成，请妥善保管，此密钥只会显示一次
              example:
                success: true
                data:
                  id: "123e4567-e89b-12d3-a456-426614174000"
                  api_key: "sk_1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                  name: "My Production API Key"
                  created_at: "2026-01-17T12:00:00Z"
                  expires_at: null
                  message: "APIKEY 已生成，请妥善保管，此密钥只会显示一次"
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    get:
      tags:
        - ApiKeys
      summary: 获取当前用户的APIKEY列表
      description: |
        获取当前已登录用户的所有APIKEY列表。
        APIKEY会部分隐藏，只显示前8位和后4位。
      operationId: listApiKeys
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: APIKEY ID
                        api_key:
                          type: string
                          description: 部分隐藏的APIKEY
                          example: sk_1234...abcd
                        name:
                          type: string
                          description: APIKEY名称
                        is_active:
                          type: boolean
                          description: 是否激活
                        last_used_at:
                          type: string
                          format: date-time
                          nullable: true
                          description: 最后使用时间
                        expires_at:
                          type: string
                          format: date-time
                          nullable: true
                          description: 过期时间
                        created_at:
                          type: string
                          format: date-time
                          description: 创建时间
              example:
                success: true
                data:
                  - id: "123e4567-e89b-12d3-a456-426614174000"
                    api_key: "sk_1234...abcd"
                    name: "My Production API Key"
                    is_active: true
                    last_used_at: "2026-01-17T12:30:00Z"
                    expires_at: null
                    created_at: "2026-01-17T12:00:00Z"
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /api-keys/{id}:
    delete:
      tags:
        - ApiKeys
      summary: 删除APIKEY
      description: 删除指定的APIKEY，删除后该APIKEY将无法再使用。
      operationId: deleteApiKey
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: APIKEY ID
          schema:
            type: string
            format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "APIKEY 已删除"
              example:
                success: true
                message: "APIKEY 已删除"
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: APIKEY不存在或无权删除
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /api-keys/{id}/toggle:
    patch:
      tags:
        - ApiKeys
      summary: 启用/禁用APIKEY
      description: 启用或禁用指定的APIKEY，禁用后的APIKEY将无法用于鉴权。
      operationId: toggleApiKey
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: APIKEY ID
          schema:
            type: string
            format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - is_active
              properties:
                is_active:
                  type: boolean
                  description: 是否激活
                  example: false
            examples:
              disable:
                summary: 禁用APIKEY
                value:
                  is_active: false
              enable:
                summary: 启用APIKEY
                value:
                  is_active: true
      responses:
        '200':
          description: 操作成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "APIKEY 已禁用"
              example:
                success: true
                message: "APIKEY 已禁用"
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                default:
                  value:
                    success: false
                    message: "is_active 必须是布尔值"
                    error: {}
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: APIKEY不存在或无权操作
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /creatomate/v1/templates:
    get:
      tags:
        - Creatomate API
      summary: 获取 Creatomate 项目中的所有模板
      description: |
        获取你的 Creatomate 项目中的所有模板列表。返回模板的元数据，包括 ID、名称、标签、创建日期和更新日期。
        
        **实际转发到**: `GET https://api.creatomate.com/v1/templates`
        
        **路径说明**: 版本号 `v1` 在接口路径中指定，支持灵活切换 API 版本。
        
        **功能说明**:
        - 返回当前项目中所有模板的元数据
        - 不包含模板的 RenderScript 源代码
        - 可用于构建模板选择器或自动化工作流
        
        **鉴权说明**:
        - 需要提供本系统的 Bearer Token 或 APIKEY
        - 本系统会自动使用 `.env` 中配置的 `API_CREATOMATE_TOKEN` 来调用 Creatomate API
        - 你的 Token 不会被转发到 Creatomate
        
        **使用场景**:
        - 构建允许用户从列表中选择模板的应用
        - 设置随机选择模板的自动化工作流
        - 获取项目中所有模板的概览
      operationId: getCreatomateTemplates
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      responses:
        '200':
          description: 成功获取模板列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "获取模板列表成功"
                  data:
                    type: array
                    description: 模板列表
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: 模板 ID
                          example: "c937d125-b99b-4690-96f0-6aa1f09438c9"
                        name:
                          type: string
                          description: 模板名称
                          example: "My Template"
                        tags:
                          type: array
                          description: 分配给模板的标签
                          items:
                            type: string
                          example: ["My", "Assigned", "Tags"]
                        created_at:
                          type: string
                          description: 创建时间
                          example: "2026-01-01 12:00:00.000 +0200"
                        updated_at:
                          type: string
                          description: 更新时间
                          example: "2026-01-01 12:00:00.000 +0200"
              examples:
                success:
                  summary: 成功响应示例
                  value:
                    success: true
                    message: "获取模板列表成功"
                    data:
                      - id: "c937d125-b99b-4690-96f0-6aa1f09438c9"
                        name: "My Template"
                        tags: ["My", "Assigned", "Tags"]
                        created_at: "2026-01-01 12:00:00.000 +0200"
                        updated_at: "2026-01-01 12:00:00.000 +0200"
                      - id: "bf95f053-28e1-4300-ac86-b52e5a3e0e5e"
                        name: "Another Template"
                        tags: []
                        created_at: "2026-01-01 12:00:00.000 +0200"
                        updated_at: "2026-01-01 12:00:00.000 +0200"
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器错误或 Creatomate API 调用失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /creatomate/v1/renders:
    get:
      tags:
        - Creatomate API
      summary: 获取 Creatomate 渲染列表
      description: |
        获取项目中的渲染任务列表，支持分页。
        
        **实际转发到**: `GET https://api.creatomate.com/v1/renders`
        
        **路径说明**: 版本号 `v1` 在接口路径中指定。
        
        **功能说明**:
        - 获取所有渲染任务的列表
        - 支持分页查询
        - 按创建时间倒序排列
        
        **鉴权说明**:
        - 需要提供本系统的 Bearer Token 或 APIKEY
        - 本系统会自动使用 `.env` 中配置的 `API_CREATOMATE_TOKEN`
        
        **使用场景**:
        - 查看历史渲染记录
        - 监控渲染队列状态
        - 批量管理渲染任务
      operationId: getCreatomateRenders
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: page
          in: query
          description: 页码（从 1 开始）
          schema:
            type: integer
            minimum: 1
            default: 1
          example: 1
        - name: limit
          in: query
          description: 每页数量（最大 100）
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          example: 10
      responses:
        '200':
          description: 成功获取渲染列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      renders:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                              description: 渲染任务 ID
                            status:
                              type: string
                              enum: [pending, processing, succeeded, failed]
                              description: 渲染状态
                            created_at:
                              type: string
                              format: date-time
                            url:
                              type: string
                              format: uri
                              description: 渲染完成后的视频 URL
                      total:
                        type: integer
                        description: 总记录数
                      page:
                        type: integer
                        description: 当前页码
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    post:
      tags:
        - Creatomate API
      summary: 创建 Creatomate 渲染任务
      description: |
        创建一个新的视频渲染任务，支持两种方式：使用模板或自定义 RenderScript。
        
        **实际转发到**: `POST https://api.creatomate.com/v1/renders`
        
        **功能说明**:
        - 基于模板创建视频（推荐）：使用 `template_id` 和 `modifications`
        - 自定义渲染：使用 `elements` 数组定义完整的视频内容
        - 异步处理：返回任务 ID，需轮询或使用 Webhook 获取结果
        
        **鉴权说明**:
        - 需要提供本系统的 Bearer Token 或 APIKEY
        - 本系统会自动使用 `.env` 中配置的 `API_CREATOMATE_TOKEN`
        
        **使用场景**:
        - 批量生成营销视频
        - 自动化视频制作工作流
        - 个性化视频内容生成
      operationId: createCreatomateRender
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        description: 渲染任务配置
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  title: 使用模板
                  required:
                    - template_id
                  properties:
                    template_id:
                      type: string
                      format: uuid
                      description: 模板 ID（从 /templates 接口获取）
                      example: "c937d125-b99b-4690-96f0-6aa1f09438c9"
                    modifications:
                      type: object
                      description: 对模板元素的修改（key 为元素名称）
                      additionalProperties: true
                      example:
                        Text-1: "Hello World"
                        Image-1: "https://example.com/image.jpg"
                - type: object
                  title: 自定义渲染
                  required:
                    - output_format
                    - width
                    - height
                    - duration
                    - elements
                  properties:
                    output_format:
                      type: string
                      enum: [mp4, mov, gif, png, jpg]
                      description: 输出格式
                      example: "mp4"
                    width:
                      type: integer
                      description: 视频宽度（像素）
                      minimum: 1
                      example: 1280
                    height:
                      type: integer
                      description: 视频高度（像素）
                      minimum: 1
                      example: 720
                    duration:
                      type: number
                      description: 视频时长（秒）
                      minimum: 0.1
                      example: 3
                    frame_rate:
                      type: integer
                      description: 帧率
                      default: 30
                      example: 30
                    elements:
                      type: array
                      description: 视频元素数组
                      items:
                        type: object
                        additionalProperties: true
            examples:
              withTemplate:
                summary: 使用模板创建（推荐）
                value:
                  template_id: "c937d125-b99b-4690-96f0-6aa1f09438c9"
                  modifications:
                    Text-1: "Hello World"
                    Text-2: "Welcome to Creatomate"
                    Image-1: "https://example.com/background.jpg"
              customRender:
                summary: 自定义渲染（高级）
                value:
                  output_format: "mp4"
                  width: 1280
                  height: 720
                  duration: 3
                  frame_rate: 30
                  elements:
                    - type: "text"
                      text: "My first video!"
                      fill_color: "#ff0000"
                      font_size: "48px"
                      width: "50%"
                      height: "25%"
                      x: "50%"
                      y: "50%"
      responses:
        '201':
          description: 渲染任务创建成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: 渲染任务 ID
                        example: "d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
                      status:
                        type: string
                        enum: [pending, processing]
                        description: 初始状态
                        example: "pending"
                      created_at:
                        type: string
                        format: date-time
                      template_id:
                        type: string
                        format: uuid
                        description: 使用的模板 ID（如果有）
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingParams:
                  summary: 缺少必需参数
                  value:
                    success: false
                    message: "Missing required field: template_id or elements"
                    error: {}
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /creatomate/v1/renders/{renderId}:
    get:
      tags:
        - Creatomate API
      summary: 获取指定渲染任务的详细信息
      description: |
        获取指定渲染任务的详细信息，包括状态、进度、结果 URL 等。
        
        **实际转发到**: `GET https://api.creatomate.com/v1/renders/{renderId}`
        
        **功能说明**:
        - 查询渲染任务的实时状态
        - 获取渲染进度百分比
        - 获取渲染完成后的视频 URL
        
        **状态说明**:
        - `pending`: 等待处理
        - `processing`: 正在渲染（可获取进度）
        - `succeeded`: 渲染成功（可获取视频 URL）
        - `failed`: 渲染失败（可获取错误信息）
        
        **鉴权说明**:
        - 需要提供本系统的 Bearer Token 或 APIKEY
        - 本系统会自动使用 `.env` 中配置的 `API_CREATOMATE_TOKEN`
        
        **使用场景**:
        - 轮询查询渲染状态
        - 获取渲染结果
        - 错误诊断
      operationId: getCreatomateRenderById
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: renderId
          in: path
          required: true
          description: 渲染任务 ID（从创建接口返回）
          schema:
            type: string
            format: uuid
          example: "d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
      responses:
        '200':
          description: 成功获取渲染任务详情
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        enum: [pending, processing, succeeded, failed]
                      progress:
                        type: integer
                        minimum: 0
                        maximum: 100
                        description: 渲染进度（百分比）
                      url:
                        type: string
                        format: uri
                        description: 渲染完成后的视频 URL（status=succeeded 时可用）
                      error:
                        type: string
                        description: 错误信息（status=failed 时可用）
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
              examples:
                pending:
                  summary: 等待处理
                  value:
                    success: true
                    data:
                      id: "d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
                      status: "pending"
                      progress: 0
                      created_at: "2026-01-22T15:00:00Z"
                processing:
                  summary: 正在渲染
                  value:
                    success: true
                    data:
                      id: "d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
                      status: "processing"
                      progress: 45
                      created_at: "2026-01-22T15:00:00Z"
                      updated_at: "2026-01-22T15:01:30Z"
                succeeded:
                  summary: 渲染成功
                  value:
                    success: true
                    data:
                      id: "d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
                      status: "succeeded"
                      progress: 100
                      url: "https://cdn.creatomate.com/renders/d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e.mp4"
                      created_at: "2026-01-22T15:00:00Z"
                      updated_at: "2026-01-22T15:02:45Z"
                failed:
                  summary: 渲染失败
                  value:
                    success: true
                    data:
                      id: "d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
                      status: "failed"
                      progress: 0
                      error: "Invalid template configuration"
                      created_at: "2026-01-22T15:00:00Z"
                      updated_at: "2026-01-22T15:00:15Z"
        '404':
          description: 渲染任务不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  value:
                    success: false
                    message: "Render not found"
                    error: {}
        '401':
          description: 鉴权失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /creatomate/{path}:
    x-summary: Creatomate 通用代理接口
    x-description: |
      用于访问未在上方明确定义的 Creatomate API 接口。
      
      **已有专用接口，请优先使用**:
      - `GET /creatomate/v1/templates` - 获取模板列表
      - `GET /creatomate/v1/renders` - 获取渲染列表
      - `POST /creatomate/v1/renders` - 创建渲染任务
      - `GET /creatomate/v1/renders/{renderId}` - 获取渲染详情
      
      **通用代理适用场景**:
      - 访问 Creatomate 的其他 API 端点
      - 使用新发布的 API 功能
      - 高级用户自定义请求
    
    get:
      tags:
        - Creatomate API
      summary: Creatomate 通用代理 - GET
      description: |
        通用代理接口，用于访问任意 Creatomate GET 端点。
        
        **实际转发到**: `GET https://api.creatomate.com/{path}`
        
        **路径说明**: 版本号需包含在 path 中，如 `v1/templates`。
        
        **注意**: 建议优先使用上方定义的专用接口，它们提供了更详细的文档和参数说明。
      operationId: proxyCreatomateGetGeneric
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: path
          in: path
          required: true
          description: "API 路径（例如: v1/templates/{id}, v1/sources, v1/fonts）"
          schema:
            type: string
          example: "v1/sources"
      responses:
        '200':
          description: 请求成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        '401':
          description: 鉴权失败
        '404':
          description: 资源不存在
    
    post:
      tags:
        - Creatomate API
      summary: Creatomate 通用代理 - POST
      description: |
        通用代理接口，用于访问任意 Creatomate POST 端点。
        
        **实际转发到**: `POST https://api.creatomate.com/{path}`
        
        **路径说明**: 版本号需包含在 path 中，如 `v1/renders`。
      operationId: proxyCreatomatePostGeneric
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: 请求成功
        '201':
          description: 资源创建成功
        '401':
          description: 鉴权失败
    
    put:
      tags:
        - Creatomate API
      summary: Creatomate 通用代理 - PUT
      description: |
        通用代理接口，用于访问任意 Creatomate PUT 端点。
        
        **实际转发到**: `PUT https://api.creatomate.com/{path}`
        
        **路径说明**: 版本号需包含在 path 中。
      operationId: proxyCreatomatePutGeneric
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: 请求成功
        '401':
          description: 鉴权失败
    
    patch:
      tags:
        - Creatomate API
      summary: Creatomate 通用代理 - PATCH
      description: |
        通用代理接口，用于访问任意 Creatomate PATCH 端点。
        
        **实际转发到**: `PATCH https://api.creatomate.com/{path}`
        
        **路径说明**: 版本号需包含在 path 中。
      operationId: proxyCreatomatePatchGeneric
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: 请求成功
        '401':
          description: 鉴权失败
    
    delete:
      tags:
        - Creatomate API
      summary: Creatomate 通用代理 - DELETE
      description: |
        通用代理接口，用于访问任意 Creatomate DELETE 端点。
        
        **实际转发到**: `DELETE https://api.creatomate.com/{path}`
        
        **路径说明**: 版本号需包含在 path 中。
        
        **使用场景**: 删除渲染任务、模板等资源
      operationId: proxyCreatomateDeleteGeneric
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: path
          in: path
          required: true
          description: "要删除的资源路径（例如: renders/{id}）"
          schema:
            type: string
          example: "renders/d8e2f891-3c4a-4b5c-8d7e-1f2a3b4c5d6e"
      responses:
        '200':
          description: 删除成功
        '204':
          description: 删除成功（无返回内容）
        '401':
          description: 鉴权失败
        '404':
          description: 资源不存在
  
  /{apiName}/{path}:
    x-summary: 其他第三方 API 通用代理
    x-description: |
      用于访问其他第三方 API（非 Creatomate）。
      
      **已支持的 API**（有专用标签）:
      - `creatomate` - Creatomate 视频渲染服务（请查看 "Creatomate API" 标签）
      
      **配置新的 API**:
      在 `.env` 文件中添加（版本号直接包含在 BASE_URL 中）：
      ```env
      API_{NAME}_BASE_URL=https://api.example.com/v1
      API_{NAME}_TOKEN=your_token
      ```
      
      **示例**:
      - Stripe: `/stripe/v1/charges`
      - SendGrid: `/sendgrid/v3/mail/send`
    
    get:
      tags:
        - Proxy
      summary: 通用代理 - GET
      description: |
        访问任意已配置的第三方 API 的 GET 端点。
        
        **实际转发到**: `GET {API_{NAME}_BASE_URL}/{path}`
        
        **路径说明**: 版本号需包含在 path 中，如 `/stripe/v1/charges`
        
        **配置要求**（版本号直接包含在 BASE_URL 中）:
        ```env
        API_{NAME}_BASE_URL=https://api.example.com/v1
        API_{NAME}_TOKEN=your_token
        ```
      operationId: proxyGenericGet
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: apiName
          in: path
          required: true
          description: API 名称（与 .env 配置对应，不区分大小写）
          schema:
            type: string
          examples:
            stripe:
              value: "stripe"
              summary: Stripe 支付
            sendgrid:
              value: "sendgrid"
              summary: SendGrid 邮件
        - name: path
          in: path
          required: true
          description: API 路径（需包含版本号）
          schema:
            type: string
          example: "v1/charges/ch_xxxxx"
      responses:
        '200':
          description: 请求成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: API 配置不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                configNotFound:
                  value:
                    success: false
                    message: "API配置不存在: myapi"
                    error: {}
        '401':
          description: 鉴权失败
        '500':
          description: 服务器错误
    
    post:
      tags:
        - Proxy
      summary: 通用代理 - POST
      description: 访问任意已配置的第三方 API 的 POST 端点。
      operationId: proxyGenericPost
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: apiName
          in: path
          required: true
          schema:
            type: string
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: 请求成功
        '201':
          description: 资源创建成功
        '400':
          description: API 配置不存在
        '401':
          description: 鉴权失败
    
    put:
      tags:
        - Proxy
      summary: 通用代理 - PUT
      description: 访问任意已配置的第三方 API 的 PUT 端点。
      operationId: proxyGenericPut
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: apiName
          in: path
          required: true
          schema:
            type: string
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: 请求成功
        '401':
          description: 鉴权失败
    
    patch:
      tags:
        - Proxy
      summary: 通用代理 - PATCH
      description: 访问任意已配置的第三方 API 的 PATCH 端点。
      operationId: proxyGenericPatch
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: apiName
          in: path
          required: true
          schema:
            type: string
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: 请求成功
        '401':
          description: 鉴权失败
    
    delete:
      tags:
        - Proxy
      summary: 通用代理 - DELETE
      description: 访问任意已配置的第三方 API 的 DELETE 端点。
      operationId: proxyGenericDelete
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: apiName
          in: path
          required: true
          schema:
            type: string
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 请求成功
        '204':
          description: 删除成功（无返回内容）
        '401':
          description: 鉴权失败

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API Key
      description: |
        临时Bearer Token鉴权方式。
        通过 `/auth/api-key` 接口获取的access_key作为Bearer token。
        格式：`Authorization: Bearer {access_key}`
        注意：此Token存储在内存中，服务重启后会失效。
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        持久化APIKEY鉴权方式。
        通过 `/api-keys` 接口创建的持久化APIKEY。
        支持两种方式：
        1. 请求头：`X-API-Key: {api_key}`
        2. 查询参数：`?api_key={api_key}`
        注意：APIKEY存储在数据库中，服务重启后仍然有效。
  
  schemas:
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          description: API返回的数据
        message:
          type: string
          description: 响应消息
    
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: 错误消息
        error:
          type: object
          description: 错误详情

security:
  - BearerAuth: []
